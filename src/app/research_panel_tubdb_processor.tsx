// src/data/research_data_processor.ts

const tubulinResearchData = {
    "5S5A": {
        "alpha": {
            "1": [
                {
                    "type": "interaction",
                    "utn_position": 1,
                    "original_aa": "M",
                    "pdb_id": "5S5A",
                    "species": "B. taurus",
                    "phenotype": "Z1449748885 (ligand) interaction",
                    "aa3_notation": "Met1",
                    "reference": "Muhlethaler et al. 2021. Angew Chem Int Ed Engl 60:13331-42",
                    "keywords": "Bos taurus, cow",
                    "notes": "Unique site ligand, α-tubulin only"
                }
            ]
        }
    },
    "5LA6": {
        "alpha": {
            "2": [
                {
                    "type": "interaction",
                    "utn_position": 2,
                    "original_aa": "R",
                    "pdb_id": "5LA6",
                    "species": "B. taurus",
                    "phenotype": "Pironetin (ligand) interaction",
                    "aa3_notation": "Arg2",
                    "reference": "Prota et al. 2016. J Mol Biol 428:2981-8",
                    "keywords": "Bos taurus, cow",
                    "notes": "Pironetin site ligand, α-tubulin only, also see 5FNV"
                }
            ],
            "3": [
                {
                    "type": "interaction",
                    "utn_position": 3,
                    "original_aa": "E",
                    "pdb_id": "5LA6",
                    "species": "B. taurus",
                    "phenotype": "Pironetin (ligand) interaction",
                    "aa3_notation": "Glu3",
                    "reference": "Prota et al. 2016. J Mol Biol 428:2981-8",
                    "keywords": "Bos taurus, cow",
                    "notes": "Pironetin site ligand, α-tubulin only, also see 5FNV"
                }
            ],
            "4": [
                {
                    "type": "interaction",
                    "utn_position": 4,
                    "original_aa": "C",
                    "pdb_id": "5LA6",
                    "species": "B. taurus",
                    "phenotype": "Pironetin (ligand) interaction",
                    "aa3_notation": "Cys4",
                    "reference": "Prota et al. 2016. J Mol Biol 428:2981-8",
                    "keywords": "Bos taurus, cow",
                    "notes": "Pironetin site ligand, α-tubulin only, also see 5FNV"
                }
            ],
            "5": [
                {
                    "type": "interaction",
                    "utn_position": 5,
                    "original_aa": "I",
                    "pdb_id": "5LA6",
                    "species": "B. taurus",
                    "phenotype": "Pironetin (ligand) interaction",
                    "aa3_notation": "Ile5",
                    "reference": "Prota et al. 2016. J Mol Biol 428:2981-8",
                    "keywords": "Bos taurus, cow",
                    "notes": "Pironetin site ligand, α-tubulin only, also see 5FNV"
                }
            ]
        }
    },
    "5S5I": {
        "alpha": {
            "2": [
                {
                    "type": "interaction",
                    "utn_position": 2,
                    "original_aa": "R",
                    "pdb_id": "5S5I",
                    "species": "B. taurus",
                    "phenotype": "Z295848548 (ligand) interaction",
                    "aa3_notation": "Arg2",
                    "reference": "Muhlethaler et al. 2021. Angew Chem Int Ed Engl 60:13331-42",
                    "keywords": "Bos taurus, cow",
                    "notes": "Unique site ligand, α-tubulin only"
                }
            ],
            "3": [
                {
                    "type": "interaction",
                    "utn_position": 3,
                    "original_aa": "E",
                    "pdb_id": "5S5I",
                    "species": "B. taurus",
                    "phenotype": "Z295848548 (ligand) interaction",
                    "aa3_notation": "Glu3",
                    "reference": "Muhlethaler et al. 2021. Angew Chem Int Ed Engl 60:13331-42",
                    "keywords": "Bos taurus, cow",
                    "notes": "Unique site ligand, α-tubulin only"
                }
            ],
            "4": [
                {
                    "type": "interaction",
                    "utn_position": 4,
                    "original_aa": "C",
                    "pdb_id": "5S5I",
                    "species": "B. taurus",
                    "phenotype": "Z295848548 (ligand) interaction",
                    "aa3_notation": "Cys4",
                    "reference": "Muhlethaler et al. 2021. Angew Chem Int Ed Engl 60:13331-42",
                    "keywords": "Bos taurus, cow",
                    "notes": "Unique site ligand, α-tubulin only"
                }
            ],
            "5": [
                {
                    "type": "interaction",
                    "utn_position": 5,
                    "original_aa": "I",
                    "pdb_id": "5S5I",
                    "species": "B. taurus",
                    "phenotype": "Z295848548 (ligand) interaction",
                    "aa3_notation": "Ile5",
                    "reference": "Muhlethaler et al. 2021. Angew Chem Int Ed Engl 60:13331-42",
                    "keywords": "Bos taurus, cow",
                    "notes": "Unique site ligand, α-tubulin only"
                }
            ]
        }
    },
    "5SB7": {
        "alpha": {
            "2": [
                {
                    "type": "interaction",
                    "utn_position": 2,
                    "original_aa": "R",
                    "pdb_id": "5SB7",
                    "species": "B. taurus",
                    "phenotype": "Todalam 18 (ligand) interaction",
                    "aa3_notation": "Arg2",
                    "reference": "Muhlethaler et al. 2022. Angew Chem Int Ed Engl 61: e202204052",
                    "keywords": "Bos taurus, cow",
                    "notes": "Unique site ligand, see β-tubulin"
                }
            ],
            "3": [
                {
                    "type": "interaction",
                    "utn_position": 3,
                    "original_aa": "E",
                    "pdb_id": "5SB7",
                    "species": "B. taurus",
                    "phenotype": "Todalam 18 (ligand) interaction",
                    "aa3_notation": "Glu3",
                    "reference": "Muhlethaler et al. 2022. Angew Chem Int Ed Engl 61: e202204052",
                    "keywords": "Bos taurus, cow",
                    "notes": "Unique site ligand, see β-tubulin"
                }
            ]
        }
    },
    "3RYF": {
        "alpha": {
            "9": [
                {
                    "type": "interaction",
                    "utn_position": 9,
                    "original_aa": "V",
                    "pdb_id": "3RYF",
                    "species": "O. aries",
                    "phenotype": "GTP interaction",
                    "aa3_notation": "Val9",
                    "reference": "Nawrotek et al. 2011. J Mol Biol 412: 35-42",
                    "keywords": "GTP binding to α/β-tubulin is required for microtubule assembly",
                    "notes": "See 3RYC, 3RYH, 3RYI"
                }
            ],
            "10": [
                {
                    "type": "interaction",
                    "utn_position": 10,
                    "original_aa": "G",
                    "pdb_id": "3RYF",
                    "species": "O. aries",
                    "phenotype": "GTP interaction",
                    "aa3_notation": "Gly10",
                    "reference": "Nawrotek et al. 2011. J Mol Biol 412: 35-42",
                    "keywords": "GTP binding to α/β-tubulin is required for microtubule assembly",
                    "notes": "See 3RYC, 3RYH, 3RYI"
                }
            ],
            "11": [
                {
                    "type": "interaction",
                    "utn_position": 11,
                    "original_aa": "Q",
                    "pdb_id": "3RYF",
                    "species": "O. aries",
                    "phenotype": "GTP interaction",
                    "aa3_notation": "Gln11",
                    "reference": "Nawrotek et al. 2011. J Mol Biol 412: 35-42",
                    "keywords": "GTP binding to α/β-tubulin is required for microtubule assembly",
                    "notes": "See 3RYC, 3RYH, 3RYI"
                }
            ]
        }
    },
    "general": {
        "alpha": {
            "1": [
                {
                    "type": "mutation",
                    "utn_position": 1,
                    "original_aa": "M",
                    "mutated_aa": "L",
                    "uniprot_id": "A6NHL2",
                    "species": "H. sapiens",
                    "phenotype": "TUBAL3 SNP, DOID:1115 / sarcoma",
                    "aa3_notation": "Met1Leu",
                    "reference": "BioMuta",
                    "keywords": "Human, cancer SNPs",
                    "notes": "Dingerdissen et al. 2018, Nucleic Acids Res 46:D1128-36, PMID 30053270."
                }
            ],
            "2": [
                {
                    "type": "mutation",
                    "utn_position": 2,
                    "original_aa": "R",
                    "mutated_aa": "A",
                    "uniprot_id": "P09733",
                    "species": "S. cerevisiae",
                    "phenotype": "Cold & temperature sensitive, benomyl supersensitive, with E3A, TUB1p",
                    "aa3_notation": "Arg2Ala",
                    "reference": "Richards et al. 2002. Mol Biol Cell 11:1887-903",
                    "keywords": "Saccharomyces cerevisiae, yeast",
                    "notes": "P09733 (TUB1)"
                },
                {
                    "type": "mutation",
                    "utn_position": 2,
                    "original_aa": "R",
                    "mutated_aa": "C",
                    "uniprot_id": "P68363",
                    "species": "H. sapiens",
                    "phenotype": "TBA1B SNP, DOID:1793 / pancreatic cancer",
                    "aa3_notation": "Arg2Cys",
                    "reference": "BioMuta",
                    "keywords": "Human, cancer SNPs",
                    "notes": "Dingerdissen et al. 2018, Nucleic Acids Res 46:D1128-36, PMID 30053270."
                },
                {
                    "type": "mutation",
                    "utn_position": 2,
                    "original_aa": "R",
                    "mutated_aa": "H",
                    "uniprot_id": "Q71U36",
                    "species": "H. sapiens",
                    "phenotype": "Microcephaly, 4 unrelated patients, tubulin alpha-1A",
                    "aa3_notation": "Arg2His",
                    "reference": "Gardner et al. 2018. Brain Sci 8:145",
                    "keywords": "Homo sapiens, human, clinical, tubulinopathy",
                    "notes": "Q71U36 (TUBA1A)"
                },
                {
                    "type": "mutation",
                    "utn_position": 2,
                    "original_aa": "R",
                    "mutated_aa": "H",
                    "uniprot_id": "Q71U36",
                    "species": "H. sapiens",
                    "phenotype": "Lissencephaly, tubulin alpha-1A",
                    "aa3_notation": "Arg2His",
                    "reference": "Guseva et al. 2021. Neuromusc Dis (Moscow) 11: 19-24",
                    "keywords": "Homo sapiens, human",
                    "notes": "Q71U36 (TUBA1A)"
                },
                {
                    "type": "mutation",
                    "utn_position": 2,
                    "original_aa": "R",
                    "mutated_aa": "K",
                    "uniprot_id": "Q0WV25",
                    "species": "A. thaliana",
                    "phenotype": "Twisting, tortifolia2, alpha-tubulin 4",
                    "aa3_notation": "Arg2Lys",
                    "reference": "Buschmann et al. 2009. Plant Cell 21:2090-106",
                    "keywords": "Arabidopsis thaliana, plant",
                    "notes": "Also see PMID 17488810, Q0WV25 (TUA4)"
                }
            ],
            "3": [
                {
                    "type": "mutation",
                    "utn_position": 3,
                    "original_aa": "E",
                    "mutated_aa": "A",
                    "uniprot_id": "P09733",
                    "species": "S. cerevisiae",
                    "phenotype": "Cold sensitive, temperature sensitive, benomyl supersensitive, with R2A, TUB1p",
                    "aa3_notation": "Glu3Ala",
                    "reference": "Richards et al. 2002. Mol Biol Cell 11:1887-903",
                    "keywords": "Saccharomyces cerevisiae, yeast",
                    "notes": "Autoregulatory domain, TUB1"
                }
            ],
            "4": [
                {
                    "type": "modification",
                    "utn_position": 4,
                    "original_aa": "C",
                    "modification_type": "PLM",
                    "uniprot_id": "A6NHL2",
                    "species": "H. sapiens",
                    "phenotype": "S-palmitoylation of cysteine 4, tubulin alpha-like 3",
                    "database": "SwissPalm",
                    "keywords": "Homo sapiens, human",
                    "notes": "Predicted, high confidence"
                },
                {
                    "type": "modification",
                    "utn_position": 4,
                    "original_aa": "C",
                    "modification_type": "PLM",
                    "uniprot_id": "P68366",
                    "species": "H. sapiens",
                    "phenotype": "S-palmitoylation of cysteine 4, tubulin alpha-4A",
                    "database": "SwissPalm",
                    "keywords": "Homo sapiens, human",
                    "notes": "Predicted, high confidence"
                },
                {
                    "type": "modification",
                    "utn_position": 4,
                    "original_aa": "C",
                    "modification_type": "PLM",
                    "uniprot_id": "P68368",
                    "species": "M. musculus",
                    "phenotype": "S-palmitoylation of cysteine 4, tubulin alpha-4a",
                    "database": "SwissPalm",
                    "keywords": "Mus musculus, mouse",
                    "notes": "Predicted, high confidence"
                }
            ],
            "5": [
                {
                    "type": "mutation",
                    "utn_position": 5,
                    "original_aa": "I",
                    "mutated_aa": "L",
                    "uniprot_id": "Q71U36",
                    "species": "H. sapiens",
                    "phenotype": "Lissencephaly, likely pathogenic, tubulin alpha-1A",
                    "aa3_notation": "Ile5Leu",
                    "reference": "ClinVar 30268",
                    "keywords": "Homo sapiens, human, clinical",
                    "notes": "Q71U36 (TUBA1A)"
                }
            ],
            "6": [
                {
                    "type": "mutation",
                    "utn_position": 6,
                    "original_aa": "S",
                    "mutated_aa": "C",
                    "uniprot_id": "Q71U36",
                    "species": "H. sapiens",
                    "phenotype": "Tubulinopathies, pathogenic, tubulin alpha-1A",
                    "aa3_notation": "Ser6Cys",
                    "reference": "ClinVar 379329",
                    "keywords": "Homo sapiens, human, clinical",
                    "notes": "Q71U36 (TUBA1A)"
                },
                {
                    "type": "modification",
                    "utn_position": 6,
                    "original_aa": "S",
                    "modification_type": "PHO",
                    "uniprot_id": "P68366",
                    "species": "H. sapiens",
                    "phenotype": "Phosphorylation of serine 6, tubulin alpha-4A",
                    "database": "iPTMnet",
                    "keywords": "Homo sapiens, human",
                    "notes": "Intermediate confidence"
                },
                {
                    "type": "modification",
                    "utn_position": 6,
                    "original_aa": "S",
                    "modification_type": "PHO",
                    "uniprot_id": "P68366",
                    "species": "H. sapiens",
                    "phenotype": "Phosphorylation of serine 6, tubulin alpha-4A",
                    "database": "PhosphoSitePlus",
                    "keywords": "Homo sapiens, human",
                    "notes": "Validated"
                },
                {
                    "type": "modification",
                    "utn_position": 6,
                    "original_aa": "S",
                    "modification_type": "OLG",
                    "uniprot_id": "Q71U36",
                    "species": "H. sapiens",
                    "phenotype": "O-GlcNAcylation of serine 6, tubulin alpha-1A",
                    "database": "GlyGen",
                    "keywords": "Homo sapiens, human",
                    "notes": "Mass spectrometry survey"
                }
            ],
            "8": [
                {
                    "type": "mutation",
                    "utn_position": 8,
                    "original_aa": "H",
                    "mutated_aa": "Y",
                    "uniprot_id": "A0A125YQG0",
                    "species": "T. gondii",
                    "phenotype": "Dinitroaniline resistant, alpha-1 tubulin",
                    "aa3_notation": "His8Tyr",
                    "reference": "Morrissette et al. 2004. Mol Biol Cell 15:1960-8",
                    "keywords": "Toxoplasma gondii, parasite",
                    "notes": "A0A125YQG0 (α1-)"
                }
            ],
            "24": [
                {
                    "type": "modification",
                    "utn_position": 24,
                    "original_aa": "Y",
                    "modification_type": "PHO",
                    "uniprot_id": "P68366",
                    "species": "H. sapiens",
                    "phenotype": "Phosphorylation of tyrosine 24, tubulin alpha-4A",
                    "database": "PhosphoSitePlus",
                    "keywords": "Homo sapiens, human",
                    "notes": "Validated"
                }
            ],
            "40": [
                {
                    "type": "modification",
                    "utn_position": 40,
                    "original_aa": "K",
                    "modification_type": "ACE",
                    "uniprot_id": "P68363",
                    "species": "H. sapiens",
                    "phenotype": "Acetylation of lysine 40, tubulin alpha-1B",
                    "database": "iPTMnet",
                    "keywords": "Homo sapiens, human",
                    "notes": "Intermediate confidence"
                },
                {
                    "type": "modification",
                    "utn_position": 40,
                    "original_aa": "K",
                    "modification_type": "ACE",
                    "uniprot_id": "P68366",
                    "species": "H. sapiens",
                    "phenotype": "Acetylation of lysine 40, tubulin alpha-4A",
                    "database": "iPTMnet",
                    "keywords": "Homo sapiens, human",
                    "notes": "Intermediate confidence"
                },
                {
                    "type": "modification",
                    "utn_position": 40,
                    "original_aa": "K",
                    "modification_type": "ACE",
                    "uniprot_id": "P68373",
                    "species": "M. musculus",
                    "phenotype": "Acetylation of lysine 40, tubulin alpha-1C",
                    "database": "PhosphoSitePlus",
                    "keywords": "Mus musculus, mouse",
                    "notes": "Validated"
                },
                {
                    "type": "modification",
                    "utn_position": 40,
                    "original_aa": "K",
                    "modification_type": "MTL1",
                    "uniprot_id": "Q71U36",
                    "species": "H. sapiens",
                    "phenotype": "Monomethylation of lysine 40, tubulin alpha-1A",
                    "database": "PhosphoSitePlus",
                    "keywords": "Homo sapiens, human",
                    "notes": "Validated"
                }
            ]
        }
    }
}
export interface ProcessedLigandData {
    id: string;
    positions: string[];
    originalAA: string[];
    pdbId: string;
    ligandName: string;
    species: string;
    description: string;
    reference: string;
    keywords: string;
    notes: string;
    aa3Notation: string[];
}

export interface ProcessedMutationData {
    id: string;
    positions: string[];
    originalAA: string[];
    mutatedAA: string[];
    pdbId: string;
    species: string;
    phenotype: string;
    reference: string;
    keywords: string;
    notes: string;
    aa3Notation: string[];
    uniprotId?: string;
}

export interface ProcessedPTMData {
    id: string;
    positions: string[];
    originalAA: string[];
    modificationType: string;
    modificationName: string;
    pdbId: string;
    species: string;
    phenotype: string;
    database?: string;
    reference?: string;
    keywords: string;
    notes: string;
    aa3Notation: string[];
    uniprotId?: string;
}

const getModificationName = (type: string): string => {
    const modNames: Record<string, string> = {
        'PHO': 'Phosphorylation',
        'ACE': 'Acetylation',
        'MTL1': 'Methylation',
        'PLM': 'Palmitoylation',
        'OLG': 'O-GlcNAcylation',
        'UBI': 'Ubiquitination',
        'SUM': 'Sumoylation',
        'GLY': 'Glycylation',
        'NIT': 'Nitrosylation'
    };
    return modNames[type] || type;
};

const extractLigandName = (phenotype: string): string => {
    // Extract ligand name from phenotype strings like "Pironetin (ligand) interaction"
    const match = phenotype.match(/^([^(]+)\s*\(ligand\)/i);
    if (match) return match[1].trim();

    // Handle GTP/GDP cases
    if (phenotype.includes('GTP')) return 'GTP';
    if (phenotype.includes('GDP')) return 'GDP';

    // Handle other patterns
    const otherMatch = phenotype.match(/^([A-Za-z0-9]+)/);
    return otherMatch ? otherMatch[1] : 'Unknown';
};

const generateUniqueId = (type: string, pdbId: string, positions: string[], index: number): string => {
    return `${type}_${pdbId}_${positions.join('_')}_${index}`;
};

export const processResearchData = () => {
    const ligands: ProcessedLigandData[] = [];
    const mutations: ProcessedMutationData[] = [];
    const ptms: ProcessedPTMData[] = [];

    // Process each PDB entry
    Object.entries(tubulinResearchData).forEach(([pdbId, pdbData]) => {
        if (!pdbData.alpha) return;

        // Group entries by type and phenotype/ligand for combining related positions
        const ligandGroups: Map<string, any[]> = new Map();
        const mutationGroups: Map<string, any[]> = new Map();
        const ptmGroups: Map<string, any[]> = new Map();

        Object.entries(pdbData.alpha).forEach(([position, entries]) => {
            entries.forEach(entry => {
                const key = entry.type === 'interaction' ? entry.phenotype :
                    entry.type === 'mutation' ? `${entry.phenotype}_${entry.mutated_aa || ''}` :
                        `${entry.modification_type}_${entry.phenotype}`;

                if (entry.type === 'interaction') {
                    if (!ligandGroups.has(key)) ligandGroups.set(key, []);
                    ligandGroups.get(key)!.push({ ...entry, position });
                } else if (entry.type === 'mutation') {
                    if (!mutationGroups.has(key)) mutationGroups.set(key, []);
                    mutationGroups.get(key)!.push({ ...entry, position });
                } else if (entry.type === 'modification') {
                    if (!ptmGroups.has(key)) ptmGroups.set(key, []);
                    ptmGroups.get(key)!.push({ ...entry, position });
                }
            });
        });

        // Process ligand groups
        let ligandIndex = 0;
        ligandGroups.forEach((entries, key) => {
            const first = entries[0];
            const positions = entries.map(e => e.position).sort((a, b) => Number(a) - Number(b));

            ligands.push({
                id: generateUniqueId('ligand', pdbId, positions, ligandIndex++),
                positions,
                originalAA: entries.map(e => e.original_aa),
                pdbId: pdbId === 'general' ? 'N/A' : pdbId,
                ligandName: extractLigandName(first.phenotype),
                species: first.species || 'Unknown',
                description: first.phenotype,
                reference: first.reference || '',
                keywords: first.keywords || '',
                notes: first.notes || '',
                aa3Notation: entries.map(e => e.aa3_notation || `${e.original_aa}${e.position}`)
            });
        });

        // Process mutation groups
        let mutationIndex = 0;
        mutationGroups.forEach((entries, key) => {
            const first = entries[0];
            const positions = entries.map(e => e.position).sort((a, b) => Number(a) - Number(b));

            mutations.push({
                id: generateUniqueId('mutation', pdbId, positions, mutationIndex++),
                positions,
                originalAA: entries.map(e => e.original_aa),
                mutatedAA: entries.map(e => e.mutated_aa || 'X'),
                pdbId: pdbId === 'general' ? 'N/A' : pdbId,
                species: first.species || 'Unknown',
                phenotype: first.phenotype,
                reference: first.reference || '',
                keywords: first.keywords || '',
                notes: first.notes || '',
                aa3Notation: entries.map(e => e.aa3_notation || `${e.original_aa}${e.position}${e.mutated_aa || ''}`),
                uniprotId: first.uniprot_id
            });
        });

        // Process PTM groups
        let ptmIndex = 0;
        ptmGroups.forEach((entries, key) => {
            const first = entries[0];
            const positions = entries.map(e => e.position).sort((a, b) => Number(a) - Number(b));

            ptms.push({
                id: generateUniqueId('ptm', pdbId, positions, ptmIndex++),
                positions,
                originalAA: entries.map(e => e.original_aa),
                modificationType: first.modification_type || 'Unknown',
                modificationName: getModificationName(first.modification_type || ''),
                pdbId: pdbId === 'general' ? 'N/A' : pdbId,
                species: first.species || 'Unknown',
                phenotype: first.phenotype,
                database: first.database,
                reference: first.reference,
                keywords: first.keywords || '',
                notes: first.notes || '',
                aa3Notation: entries.map(e => e.aa3_notation || `${e.original_aa}${e.position}`),
                uniprotId: first.uniprot_id
            });
        });
    });

    return {
        ligands: ligands.slice(0, 50), // Limit for demo
        mutations: mutations.slice(0, 50),
        ptms: ptms.slice(0, 50)
    };
};